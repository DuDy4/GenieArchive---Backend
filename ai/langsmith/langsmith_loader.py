import os

from ..models import Models
from langchain import hub
from langchain_openai import ChatOpenAI
from dotenv import load_dotenv

load_dotenv()

class Langsmith:
    def __init__(self):
        self.api_key = os.environ.get('LANGSMITH_API_KEY')
        self.base_url = 'https://api.langsmith.com/v1'
        self.model = ChatOpenAI(model=Models.GPT_4O)

    def run_prompt_test(self, person_data):
        prompt = hub.pull("profile_person")
        try:
            runnable = prompt | self.model
            response = runnable.invoke({person_data})
        except Exception as e:
            response = f"Error: {e}"
        return response


# Example usage
if __name__ == '__main__':

    asaf_data = '{   "id": "bov1GRExBWshHHlV1L0Qqg_0000",   "full_name": "asaf savich",   "first_name": "asaf",   "middle_initial": "",   "middle_name": "",   "last_initial": "s",   "last_name": "savich",   "sex": "male",   "birth_year": "",   "birth_date": "",   "linkedin_url": "linkedin.com/in/asaf-savich",   "linkedin_username": "asaf-savich",   "linkedin_id": "276091652",   "facebook_url": "",   "facebook_username": "",   "facebook_id": "",   "twitter_url": "",   "twitter_username": "",   "github_url": "",   "github_username": "",   "work_email": "",   "personal_emails": [],   "recommended_personal_email": "",   "mobile_phone": "",   "industry": "computer software",   "job_title": "director of engineering",   "job_title_role": "engineering",   "job_title_sub_role": "",   "job_title_levels": [     "director"   ],   "job_company_id": "FJ76qQuNgHEcuG6bmmpSBw2Uigpr",   "job_company_name": "kubiya.ai",   "job_company_website": "kubiya.ai",   "job_company_size": "11-50",   "job_company_founded": 2022,   "job_company_industry": "",   "job_company_linkedin_url": "linkedin.com/company/kubiya",   "job_company_linkedin_id": "86714205",   "job_company_facebook_url": "",   "job_company_twitter_url": "",   "job_company_location_name": "sunnyvale, california, united states",   "job_company_location_locality": "sunnyvale",   "job_company_location_metro": "san jose, california",   "job_company_location_region": "california",   "job_company_location_geo": "37.36,-122.03",   "job_company_location_street_address": "",   "job_company_location_address_line_2": "",   "job_company_location_postal_code": "",   "job_company_location_country": "united states",   "job_company_location_continent": "north america",   "job_last_changed": "2024-03-21",   "job_last_verified": "2024-03-25",   "job_last_updated": "2024-03-25",   "job_start_date": "2023-04",   "location_name": "israel",   "location_locality": "",   "location_metro": "",   "location_region": "",   "location_country": "israel",   "location_continent": "asia",   "location_street_address": "",   "location_address_line_2": "",   "location_postal_code": "",   "location_geo": "",   "location_last_updated": "2024-03-25",   "phone_numbers": [],   "emails": [     {       "address": "asaf.savich@whitesourcesoftware.com",       "type": "professional"     },     {       "address": "asaf@safedk.com",       "type": "professional"     }   ],   "interests": [],   "skills": [     "java",     "software development",     "c#",     "android development",     "oop",     "c",     "object oriented design",     "html",     "android",     "programming",     "object oriented programming",     "software quality assurance",     "quality center",     "test automation",     "test execution",     "integration testing",     "testing",     "hp quality center",     "mobile applications",     "manual testing",     "regression testing",     "software design"   ],   "location_names": [],   "regions": [],   "countries": [     "israel"   ],   "street_addresses": [],   "experience": [     {       "company": {         "name": "kubiya.ai",         "size": "11-50",         "id": "FJ76qQuNgHEcuG6bmmpSBw2Uigpr",         "founded": 2022,         "industry": "",         "location": {           "name": "sunnyvale, california, united states",           "locality": "sunnyvale",           "region": "california",           "metro": "san jose, california",           "country": "united states",           "continent": "north america",           "street_address": "",           "address_line_2": "",           "postal_code": "",           "geo": "37.36,-122.03"         },         "linkedin_url": "linkedin.com/company/kubiya",         "linkedin_id": "86714205",         "facebook_url": "",         "twitter_url": "",         "website": "kubiya.ai"       },       "location_names": [],       "end_date": "",       "start_date": "2023-04",       "title": {         "name": "director of engineering",         "role": "engineering",         "sub_role": "",         "levels": [           "director"         ]       },       "is_primary": true     },     {       "company": {         "name": "mend.io",         "size": "201-500",         "id": "fCAGFPoo1SLGXQTTwY5C3wgs0352",         "founded": 2011,         "industry": "computer software",         "location": {           "name": "boston, massachusetts, united states",           "locality": "boston",           "region": "massachusetts",           "metro": "boston, massachusetts",           "country": "united states",           "continent": "north america",           "street_address": "33 arch street",           "address_line_2": "suite 1700",           "postal_code": "02110",           "geo": "42.35,-71.06"         },         "linkedin_url": "linkedin.com/company/mend-io",         "linkedin_id": "2440656",         "facebook_url": "facebook.com/whitesource",         "twitter_url": "twitter.com/whtsrc",         "website": "mend.io"       },       "location_names": [],       "end_date": "2023-04",       "start_date": "2020-12",       "title": {         "name": "research and development director",         "role": "education",         "sub_role": "researcher",         "levels": [           "director"         ]       },       "is_primary": false     },     {       "company": {         "name": "vaica",         "size": "11-50",         "id": "FvpuOYdoBnUCvDvKNju7VA2uSy8T",         "founded": 2007,         "industry": "medical devices",         "location": {           "name": "israel",           "locality": "",           "region": "",           "metro": "",           "country": "israel",           "continent": "asia",           "street_address": "",           "address_line_2": "",           "postal_code": "",           "geo": ""         },         "linkedin_url": "linkedin.com/company/vaica",         "linkedin_id": "10535016",         "facebook_url": "",         "twitter_url": "twitter.com/vaicamed",         "website": "vaica.com"       },       "location_names": [],       "end_date": "2016-06",       "start_date": "2015-11",       "title": {         "name": "software engineer",         "role": "engineering",         "sub_role": "software",         "levels": []       },       "is_primary": false     },     {       "company": {         "name": "mend.io",         "size": "201-500",         "id": "fCAGFPoo1SLGXQTTwY5C3wgs0352",         "founded": 2011,         "industry": "computer software",         "location": {           "name": "boston, massachusetts, united states",           "locality": "boston",           "region": "massachusetts",           "metro": "boston, massachusetts",           "country": "united states",           "continent": "north america",           "street_address": "33 arch street",           "address_line_2": "suite 1700",           "postal_code": "02110",           "geo": "42.35,-71.06"         },         "linkedin_url": "linkedin.com/company/mend-io",         "linkedin_id": "2440656",         "facebook_url": "facebook.com/whitesource",         "twitter_url": "twitter.com/whtsrc",         "website": "mend.io"       },       "location_names": [],       "end_date": "2017-11",       "start_date": "2016-07",       "title": {         "name": "software engineer",         "role": "engineering",         "sub_role": "software",         "levels": []       },       "is_primary": false     },     {       "company": {         "name": "mend.io",         "size": "201-500",         "id": "fCAGFPoo1SLGXQTTwY5C3wgs0352",         "founded": 2011,         "industry": "computer software",         "location": {           "name": "boston, massachusetts, united states",           "locality": "boston",           "region": "massachusetts",           "metro": "boston, massachusetts",           "country": "united states",           "continent": "north america",           "street_address": "33 arch street",           "address_line_2": "suite 1700",           "postal_code": "02110",           "geo": "42.35,-71.06"         },         "linkedin_url": "linkedin.com/company/mend-io",         "linkedin_id": "2440656",         "facebook_url": "facebook.com/whitesource",         "twitter_url": "twitter.com/whtsrc",         "website": "mend.io"       },       "location_names": [],       "end_date": "2018-12",       "start_date": "2017-11",       "title": {         "name": "lead software engineer",         "role": "engineering",         "sub_role": "software",         "levels": [           "manager"         ]       },       "is_primary": false     },     {       "company": {         "name": "safedk",         "size": "11-50",         "id": "pCJbcWmseUwbuCred97V6QR7VYw2",         "founded": 2014,         "industry": "computer software",         "location": "",         "linkedin_url": "linkedin.com/company/safedk",         "linkedin_id": "4863891",         "facebook_url": "facebook.com/safedk",         "twitter_url": "twitter.com/getsafedk",         "website": "safedk.com"       },       "location_names": [],       "end_date": "2015-09",       "start_date": "2015-01",       "title": {         "name": "research and development intern",         "role": "education",         "sub_role": "researcher",         "levels": [           "training"         ]       },       "is_primary": false     },     {       "company": {         "name": "test direct (now qualitest)",         "size": "51-200",         "id": "9ZXFkTN0LvXA0FywHESCUAqBRPVs",         "founded": 2002,         "industry": "information technology and services",         "location": {           "name": "preston, lancashire, united kingdom",           "locality": "preston",           "region": "lancashire",           "metro": "",           "country": "united kingdom",           "continent": "europe",           "street_address": "",           "address_line_2": "",           "postal_code": "",           "geo": "53.76,-2.71"         },         "linkedin_url": "linkedin.com/company/qualitest-group",         "linkedin_id": "155573",         "facebook_url": "facebook.com/qualitest-group-297508626937610",         "twitter_url": "",         "website": "test-direct.com"       },       "location_names": [         "netanya, hamerkaz, israel"       ],       "end_date": "2013-04",       "start_date": "2010-01",       "title": {         "name": "software testing",         "role": "engineering",         "sub_role": "software",         "levels": []       },       "is_primary": false     },     {       "company": {         "name": "mend.io",         "size": "201-500",         "id": "fCAGFPoo1SLGXQTTwY5C3wgs0352",         "founded": 2011,         "industry": "computer software",         "location": {           "name": "boston, massachusetts, united states",           "locality": "boston",           "region": "massachusetts",           "metro": "boston, massachusetts",           "country": "united states",           "continent": "north america",           "street_address": "33 arch street",           "address_line_2": "suite 1700",           "postal_code": "02110",           "geo": "42.35,-71.06"         },         "linkedin_url": "linkedin.com/company/mend-io",         "linkedin_id": "2440656",         "facebook_url": "facebook.com/whitesource",         "twitter_url": "twitter.com/whtsrc",         "website": "mend.io"       },       "location_names": [],       "end_date": "2020-12",       "start_date": "2018-12",       "title": {         "name": "backend team leader",         "role": "",         "sub_role": "",         "levels": [           "manager"         ]       },       "is_primary": false     }   ],   "education": [     {       "school": {         "name": "idc herzliya",         "type": "post-secondary institution",         "id": "CTl9f93u6aDYpit4J-8GEQ_0",         "location": {           "name": "israel",           "country": "israel",           "locality": "",           "continent": "asia",           "region": ""         },         "linkedin_url": "linkedin.com/school/business-data-analytics-idc-herzliya",         "facebook_url": "facebook.com/idc.herzliya",         "twitter_url": "twitter.com/idcherzliya",         "linkedin_id": "78275112",         "website": "idc.ac.il",         "domain": "idc.ac.il"       },       "degrees": [         "bachelors",         "bachelor of science"       ],       "start_date": "2010",       "end_date": "2012",       "majors": [],       "minors": [],       "gpa": ""     },     {       "school": {         "name": "idc herzliya",         "type": "post-secondary institution",         "id": "CTl9f93u6aDYpit4J-8GEQ_0",         "location": {           "name": "israel",           "country": "israel",           "locality": "",           "continent": "asia",           "region": ""         },         "linkedin_url": "linkedin.com/school/business-data-analytics-idc-herzliya",         "facebook_url": "facebook.com/idc.herzliya",         "twitter_url": "twitter.com/idcherzliya",         "linkedin_id": "78275112",         "website": "idc.ac.il",         "domain": "idc.ac.il"       },       "degrees": [         "bachelors",         "bachelor of arts",         "bachelor of science"       ],       "start_date": "2013",       "end_date": "2016",       "majors": [],       "minors": [],       "gpa": ""     }   ],   "profiles": [     {       "network": "linkedin",       "id": "276091652",       "url": "linkedin.com/in/asaf-savich",       "username": "asaf-savich"     },     {       "network": "linkedin",       "id": "276091652",       "url": "linkedin.com/in/asaf-savich-31856778",       "username": "asaf-savich-31856778"     }   ],   "version_status": {     "status": "",     "contains": [],     "previous_version": "",     "current_version": ""   } }'
    langsmith = Langsmith()
    langsmith.run_prompt_test(asaf_data)

