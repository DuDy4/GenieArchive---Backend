import sys
import os
import json

sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), "..")))

from data.data_common.repositories.personal_data_repository import (
    PersonalDataRepository,
)
from data.data_common.dependencies.dependencies import (
    get_db_connection,
)


def test_personal_data():
    conn = get_db_connection()
    personal_data_repository = PersonalDataRepository(conn=conn)
    uuid = "ThisIsATest"
    name = "Asaf Savich"
    email = "asaf@genieai.ai"
    linkedin = "linkedin.com/in/asaf-savich"
    personal_data = {
        "sex": "male",
        "industry": "computer software",
        "profiles": [
            {
                "id": "276091652",
                "url": "linkedin.com/in/asaf-savich",
                "network": "linkedin",
                "username": "asaf-savich",
            },
        ],
        "full_name": "asaf savich",
        "interests": [],
        "job_title": "director of engineering",
        "last_name": "savich",
        "experience": [
            {
                "title": {
                    "name": "director of engineering",
                    "role": "engineering",
                    "levels": ["director"],
                    "sub_role": None,
                },
                "company": {
                    "id": "FJ76qQuNgHEcuG6bmmpSBw2Uigpr",
                    "name": "kubiya.ai",
                    "size": "11-50",
                    "founded": 2022,
                    "website": "kubiya.ai",
                    "industry": None,
                    "location": {
                        "geo": "37.36,-122.03",
                        "name": "sunnyvale, california, united states",
                        "metro": "san jose, california",
                        "region": "california",
                        "country": "united states",
                        "locality": "sunnyvale",
                        "continent": "north america",
                        "postal_code": None,
                        "address_line_2": None,
                        "street_address": None,
                    },
                    "linkedin_id": "86714205",
                    "twitter_url": None,
                    "facebook_url": None,
                    "linkedin_url": "linkedin.com/company/kubiya",
                },
                "end_date": None,
                "is_primary": True,
                "start_date": "2023-04",
                "location_names": [],
            },
            {
                "title": {
                    "name": "research and development director",
                    "role": "education",
                    "levels": ["director"],
                    "sub_role": "researcher",
                },
                "company": {
                    "id": "fCAGFPoo1SLGXQTTwY5C3wgs0352",
                    "name": "mend.io",
                    "size": "201-500",
                    "founded": 2011,
                    "website": "mend.io",
                    "industry": "computer software",
                    "location": {
                        "geo": "42.35,-71.06",
                        "name": "boston, massachusetts, united states",
                        "metro": "boston, massachusetts",
                        "region": "massachusetts",
                        "country": "united states",
                        "locality": "boston",
                        "continent": "north america",
                        "postal_code": "02110",
                        "address_line_2": "suite 1700",
                        "street_address": "33 arch street",
                    },
                    "linkedin_id": "2440656",
                    "twitter_url": "twitter.com/whtsrc",
                    "facebook_url": "facebook.com/whitesource",
                    "linkedin_url": "linkedin.com/company/white-source",
                },
                "end_date": "2023-04",
                "is_primary": False,
                "start_date": "2020-12",
                "location_names": [],
            },
            {
                "title": {
                    "name": "software engineer",
                    "role": "engineering",
                    "levels": [],
                    "sub_role": "software",
                },
                "company": {
                    "id": "FvpuOYdoBnUCvDvKNju7VA2uSy8T",
                    "name": "vaica",
                    "size": "11-50",
                    "founded": 2007,
                    "website": "vaica.com",
                    "industry": "medical devices",
                    "location": {
                        "geo": None,
                        "name": "israel",
                        "metro": None,
                        "region": None,
                        "country": "israel",
                        "locality": None,
                        "continent": "asia",
                        "postal_code": None,
                        "address_line_2": None,
                        "street_address": None,
                    },
                    "linkedin_id": "10535016",
                    "twitter_url": "twitter.com/vaicamed",
                    "facebook_url": None,
                    "linkedin_url": "linkedin.com/company/vaica",
                },
                "end_date": "2016-06",
                "is_primary": False,
                "start_date": "2015-11",
                "location_names": [],
            },
            {
                "title": {
                    "name": "software engineer",
                    "role": "engineering",
                    "levels": [],
                    "sub_role": "software",
                },
                "company": {
                    "id": "fCAGFPoo1SLGXQTTwY5C3wgs0352",
                    "name": "mend.io",
                    "size": "201-500",
                    "founded": 2011,
                    "website": "mend.io",
                    "industry": "computer software",
                    "location": {
                        "geo": "42.35,-71.06",
                        "name": "boston, massachusetts, united states",
                        "metro": "boston, massachusetts",
                        "region": "massachusetts",
                        "country": "united states",
                        "locality": "boston",
                        "continent": "north america",
                        "postal_code": "02110",
                        "address_line_2": "suite 1700",
                        "street_address": "33 arch street",
                    },
                    "linkedin_id": "2440656",
                    "twitter_url": "twitter.com/whtsrc",
                    "facebook_url": "facebook.com/whitesource",
                    "linkedin_url": "linkedin.com/company/white-source",
                },
                "end_date": "2017-11",
                "is_primary": False,
                "start_date": "2016-07",
                "location_names": [],
            },
            {
                "title": {
                    "name": "lead software engineer",
                    "role": "engineering",
                    "levels": ["manager"],
                    "sub_role": "software",
                },
                "company": {
                    "id": "fCAGFPoo1SLGXQTTwY5C3wgs0352",
                    "name": "mend.io",
                    "size": "201-500",
                    "founded": 2011,
                    "website": "mend.io",
                    "industry": "computer software",
                    "location": {
                        "geo": "42.35,-71.06",
                        "name": "boston, massachusetts, united states",
                        "metro": "boston, massachusetts",
                        "region": "massachusetts",
                        "country": "united states",
                        "locality": "boston",
                        "continent": "north america",
                        "postal_code": "02110",
                        "address_line_2": "suite 1700",
                        "street_address": "33 arch street",
                    },
                    "linkedin_id": "2440656",
                    "twitter_url": "twitter.com/whtsrc",
                    "facebook_url": "facebook.com/whitesource",
                    "linkedin_url": "linkedin.com/company/white-source",
                },
                "end_date": "2018-12",
                "is_primary": False,
                "start_date": "2017-11",
                "location_names": [],
            },
            {
                "title": {
                    "name": "research and development intern",
                    "role": "education",
                    "levels": ["training"],
                    "sub_role": "researcher",
                },
                "company": {
                    "id": "pCJbcWmseUwbuCred97V6QR7VYw2",
                    "name": "safedk",
                    "size": "11-50",
                    "founded": 2014,
                    "website": "safedk.com",
                    "industry": "computer software",
                    "location": None,
                    "linkedin_id": "4863891",
                    "twitter_url": "twitter.com/getsafedk",
                    "facebook_url": "facebook.com/safedk",
                    "linkedin_url": "linkedin.com/company/safedk",
                },
                "end_date": "2015-09",
                "is_primary": False,
                "start_date": "2015-01",
                "location_names": [],
            },
            {
                "title": {
                    "name": "software testing",
                    "role": "engineering",
                    "levels": [],
                    "sub_role": "software",
                },
                "company": {
                    "id": "9ZXFkTN0LvXA0FywHESCUAqBRPVs",
                    "name": "test direct (now qualitest)",
                    "size": "51-200",
                    "founded": 2002,
                    "website": "test-direct.com",
                    "industry": "information technology and services",
                    "location": {
                        "geo": "53.76,-2.71",
                        "name": "preston, lancashire, united kingdom",
                        "metro": None,
                        "region": "lancashire",
                        "country": "united kingdom",
                        "locality": "preston",
                        "continent": "europe",
                        "postal_code": None,
                        "address_line_2": None,
                        "street_address": None,
                    },
                    "linkedin_id": "155573",
                    "twitter_url": None,
                    "facebook_url": "facebook.com/qualitest-group-297508626937610",
                    "linkedin_url": "linkedin.com/company/test-direct",
                },
                "end_date": "2013-04",
                "is_primary": False,
                "start_date": "2010-01",
                "location_names": ["netanya, hamerkaz, israel"],
            },
            {
                "title": {
                    "name": "backend team leader",
                    "role": None,
                    "levels": ["manager"],
                    "sub_role": None,
                },
                "company": {
                    "id": "fCAGFPoo1SLGXQTTwY5C3wgs0352",
                    "name": "mend.io",
                    "size": "201-500",
                    "founded": 2011,
                    "website": "mend.io",
                    "industry": "computer software",
                    "location": {
                        "geo": "42.35,-71.06",
                        "name": "boston, massachusetts, united states",
                        "metro": "boston, massachusetts",
                        "region": "massachusetts",
                        "country": "united states",
                        "locality": "boston",
                        "continent": "north america",
                        "postal_code": "02110",
                        "address_line_2": "suite 1700",
                        "street_address": "33 arch street",
                    },
                    "linkedin_id": "2440656",
                    "twitter_url": "twitter.com/whtsrc",
                    "facebook_url": "facebook.com/whitesource",
                    "linkedin_url": "linkedin.com/company/white-source",
                },
                "end_date": "2020-12",
                "is_primary": False,
                "start_date": "2018-12",
                "location_names": [],
            },
        ],
        "version_status": {
            "status": "updated",
            "contains": ["Bs98ZY6vj1JgAXctCZ0yiw_0000"],
            "current_version": "27.0",
            "previous_version": "26.0",
        },
        "dataset_version": "27.0",
        "job_company_name": "Genie AI",
        "job_company_size": "1-10",
        "job_last_changed": "2024-03-21",
        "job_title_levels": ["founder"],
        "location_country": "israel",
    }
    if not personal_data_repository.exists_uuid(uuid):
        personal_data_repository.insert(
            uuid, name, email, linkedin, json.dumps(personal_data)
        )
    assert personal_data_repository.exists_uuid(uuid)
    print("Ownership test passed")


test_personal_data()
